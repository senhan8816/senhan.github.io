<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.38">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>性能优化 | React教程</title><meta name="description" content="React是用于构建用户界面的JavaScript库，起源于Facebook(现meta)的内部项目，由于市场上所有 JavaScript框架不满意，决定自行开发一套，用于Instagram的网站。于2013年5月开源。">
    <link rel="modulepreload" href="/react-docs/assets/app.a98f98c2.js"><link rel="modulepreload" href="/react-docs/assets/performance.html.6e79cc27.js"><link rel="modulepreload" href="/react-docs/assets/performance.html.5b4585d0.js">
    <link rel="stylesheet" href="/react-docs/assets/style.b940a1e9.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/react-docs/" class=""><img class="logo" src="/react-docs/images/mylogo.png" alt="React教程"><span class="site-name can-hide">React教程</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/react-docs/react_basic" class="router-link-active" aria-label="react基础"><!--[--><!--]--> react基础 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/react-docs/redux/intro" class="" aria-label="redux(状态管理)"><!--[--><!--]--> redux(状态管理) <!--[--><!--]--></a></div><div class="navbar-item"><a href="/react-docs/react-router/spa" class="" aria-label="react-router(路由)"><!--[--><!--]--> react-router(路由) <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/react-docs/react_basic" class="router-link-active" aria-label="react基础"><!--[--><!--]--> react基础 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/react-docs/redux/intro" class="" aria-label="redux(状态管理)"><!--[--><!--]--> redux(状态管理) <!--[--><!--]--></a></div><div class="navbar-item"><a href="/react-docs/react-router/spa" class="" aria-label="react-router(路由)"><!--[--><!--]--> react-router(路由) <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/react-docs/react_basic/basic_use/first_use" class="sidebar-item sidebar-heading" aria-label="react基本使用"><!--[--><!--]--> react基本使用 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/react-docs/react_basic/basic_use/first_use" class="sidebar-item" aria-label="在html中引入和使用"><!--[--><!--]--> 在html中引入和使用 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/react-docs/react_basic/basic_use/first_use#特殊属性" class="sidebar-item" aria-label="特殊属性"><!--[--><!--]--> 特殊属性 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/react-docs/react_basic/basic_use/jsx" class="sidebar-item" aria-label="JSX"><!--[--><!--]--> JSX <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/react-docs/react_basic/basic_use/jsx#介绍" class="sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/basic_use/jsx#注意点" class="sidebar-item" aria-label="注意点"><!--[--><!--]--> 注意点 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/basic_use/jsx#动态插入数据" class="sidebar-item" aria-label="动态插入数据"><!--[--><!--]--> 动态插入数据 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/basic_use/jsx#条件渲染" class="sidebar-item" aria-label="条件渲染"><!--[--><!--]--> 条件渲染 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/basic_use/jsx#列表渲染" class="sidebar-item" aria-label="列表渲染"><!--[--><!--]--> 列表渲染 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/basic_use/jsx#添加行内样式" class="sidebar-item" aria-label="添加行内样式"><!--[--><!--]--> 添加行内样式 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/basic_use/jsx#绑定事件" class="sidebar-item" aria-label="绑定事件"><!--[--><!--]--> 绑定事件 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/basic_use/jsx#案例练习" class="sidebar-item" aria-label="案例练习"><!--[--><!--]--> 案例练习 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a href="/react-docs/react_basic/create-react-app" class="sidebar-item sidebar-heading" aria-label="create-react-app"><!--[--><!--]--> create-react-app <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/component/intro" class="sidebar-item sidebar-heading" aria-label="组件"><!--[--><!--]--> 组件 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/react-docs/react_basic/component/intro" class="sidebar-item" aria-label="组件介绍&amp;使用"><!--[--><!--]--> 组件介绍&amp;使用 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/component/state" class="sidebar-item" aria-label="类组件的状态"><!--[--><!--]--> 类组件的状态 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/component/this" class="sidebar-item" aria-label="类组件中函数的 this 问题"><!--[--><!--]--> 类组件中函数的 this 问题 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/component/props" class="sidebar-item" aria-label="props"><!--[--><!--]--> props <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/component/todoList" class="sidebar-item" aria-label="组件案例-任务列表(todoList)"><!--[--><!--]--> 组件案例-任务列表(todoList) <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/component/form" class="sidebar-item" aria-label="操作表单"><!--[--><!--]--> 操作表单 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/component/life" class="sidebar-item" aria-label="类组件的生命周期"><!--[--><!--]--> 类组件的生命周期 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/component/communication" class="sidebar-item" aria-label="组件通讯"><!--[--><!--]--> 组件通讯 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/react-docs/react_basic/hoc&amp;rp" class="sidebar-item sidebar-heading" aria-label="HOC 和 renderprops"><!--[--><!--]--> HOC 和 renderprops <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/react-docs/react_basic/hoc&amp;rp#高阶组件-hoc" class="sidebar-item" aria-label="HOC"><!--[--><!--]--> HOC <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/hoc&amp;rp#renderprops" class="sidebar-item" aria-label="renderprops"><!--[--><!--]--> renderprops <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/react-docs/react_basic/hook" class="sidebar-item sidebar-heading" aria-label="HOOK"><!--[--><!--]--> HOOK <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/performance" class="router-link-active sidebar-item sidebar-heading active" aria-label="性能优化"><!--[--><!--]--> 性能优化 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/diff" class="sidebar-item sidebar-heading" aria-label="虚拟DOM和diff算法"><!--[--><!--]--> 虚拟DOM和diff算法 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/others" class="sidebar-item sidebar-heading" aria-label="其他"><!--[--><!--]--> 其他 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/react-docs/react_basic/others#fragment" class="sidebar-item" aria-label="Fragment"><!--[--><!--]--> Fragment <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/others#portals" class="sidebar-item" aria-label="Portals"><!--[--><!--]--> Portals <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/others#forwardref" class="sidebar-item" aria-label="forwardRef"><!--[--><!--]--> forwardRef <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/others#组件懒加载" class="sidebar-item" aria-label="组件懒加载"><!--[--><!--]--> 组件懒加载 <!--[--><!--]--></a><!----></li><li><a href="/react-docs/react_basic/others#国际化" class="sidebar-item" aria-label="国际化"><!--[--><!--]--> 国际化 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="性能优化" tabindex="-1"><a class="header-anchor" href="#性能优化" aria-hidden="true">#</a> 性能优化</h1><p>UI 更新需要昂贵的 DOM 操作，因此 React 内部使用了几种巧妙的技术来最小化 DOM 操作次数</p><h2 id="减轻-state" tabindex="-1"><a class="header-anchor" href="#减轻-state" aria-hidden="true">#</a> 减轻 state</h2><p>和渲染相关的数据存储到 state,与渲染无关的数据不要存储在 state 里面 . 如果将与渲染无关的数据存储到 state 中,修改数据时调用 setState.是导致组件更新.造成没有必要的重新渲染</p><h2 id="shouldcomponentupdate" tabindex="-1"><a class="header-anchor" href="#shouldcomponentupdate" aria-hidden="true">#</a> shouldComponentUpdate</h2><p>shouldComponentUpdate 在组件的更新阶段执行.</p><p>父组件更新或调用当前组件的 setState 会触发 shouldComponentUpdate.</p><p>shouldComponentUpdate 的返回值绝对了组件 render 函数是否执行. 返回 true 执行,返回 false 不执行</p><h2 id="purecomponent-纯组件" tabindex="-1"><a class="header-anchor" href="#purecomponent-纯组件" aria-hidden="true">#</a> PureComponent(纯组件)</h2><p><code>shouldComponentUpdate</code>有一个缺点: 如果组件中的 state 和 props 很多,则开发者需要写很多判断表达式,令人厌烦.所以 react 提供了一个 <code>PureComponent</code> 帮我们解决这个问题</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>
<span class="token comment">// 在Demo组件中继承PureComponent 可以实现和shouldComponentUpdate相同的效果</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">&#39;hello scu&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;demo更新了&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        Demo
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>msg<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
          <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">&gt;</span></span><span class="token plain-text">
          demo-按钮
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><strong><code>React.PureComponent</code> 与 <code>React.Component</code>很相似。两者的区别在于 <code>React.Component</code>并未实现 <code>shouldComponentUpdate()</code>，而 <code>React.PureComponent</code> 中以浅层对比 prop 和 state 的方式来实现了该函数。</strong></p><p><strong>注意:</strong><code>React.PureComponent</code> 中的 <code>shouldComponentUpdate()</code> 仅作对象的浅层比较。如果对象中包含复杂的数据结构，则有可能因为无法检查深层的差别，产生错误的比对结果</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>button
  onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 直接修改obj中name的值.纯组件在比较时,只比较obj中存储的对象地址是否发生变化,这时不认为数据变化,则不会正确更新</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;ls&#39;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">obj</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>obj<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&gt;</span>
  demo<span class="token operator">-</span>按钮
<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>解决方式:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>button
  onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 根据obj生成新的newObj对象. 将newObj赋值给obj.这时obj的地址发生变化,组件就可以正确更新了</span>
    <span class="token comment">// 实际开发中,经常会使用第三方组件,第三方组件中可能使用了PureComponent,所以修改数据时,最好都根据旧数据生成新数据,以避免组件无法更新的错误</span>
    <span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>obj <span class="token punctuation">}</span>
    newObj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;ls&#39;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">obj</span><span class="token operator">:</span> newObj<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&gt;</span>
  demo<span class="token operator">-</span>按钮
<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="usestate" tabindex="-1"><a class="header-anchor" href="#usestate" aria-hidden="true">#</a> useState</h2><blockquote><p>shouldComponentUpdate 和 PureComponent 只使用于类组件,函数组件无法使用. 所以 react 团队在定义<code>useState</code>的时候,就考虑到了这个问题. 如果使用 useState 定义状态,则状态没有发生变化,函数组件不会更新.</p></blockquote><h2 id="usecallback" tabindex="-1"><a class="header-anchor" href="#usecallback" aria-hidden="true">#</a> useCallback</h2><blockquote><p>用于缓存函数组件中定义的函数,减少函数创建次数.</p></blockquote><h2 id="usememo" tabindex="-1"><a class="header-anchor" href="#usememo" aria-hidden="true">#</a> useMemo</h2><blockquote><p>用于缓存函数计算的结果,减少函数调用次数.</p></blockquote><h2 id="react-memo" tabindex="-1"><a class="header-anchor" href="#react-memo" aria-hidden="true">#</a> React.memo</h2><blockquote><p><code>useState</code>已经处理了 state 没有变化,则函数组件不更新. 但是父组件更新,作为子组件的函数组件还是会更新,所以 react 提供了 memo 方法,帮我们解决这个问题</p></blockquote><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>

<span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Test组件只在父组件传入新的props时更新</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Test</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>Test<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>React.Memo 默认情况下只会对复杂对象做浅层对比，如果你想要控制对比过程，那么请将自定义的比较函数通过第二个参数传入来实现</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">equal</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// prevProps是上一次props数据</span>
  <span class="token comment">// nextProps是最新的props数据</span>
  <span class="token comment">// 注意: 如果返回true则不更新,返回false则更新</span>
  <span class="token keyword">return</span> prevProps<span class="token punctuation">.</span>属性 <span class="token operator">===</span> nextProps<span class="token punctuation">.</span>属性
<span class="token punctuation">}</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>

<span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Test组件只在父组件传入新的props时更新</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Test</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>Test<span class="token punctuation">,</span> equal<span class="token punctuation">)</span>
</code></pre><div class="highlight-lines"><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br><br><br><div class="highlight-line"> </div></div><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="key" tabindex="-1"><a class="header-anchor" href="#key" aria-hidden="true">#</a> key</h2><p>列表渲染时给子元素添加 key，React 使用 key 来匹配原有树上的子元素以及最新树上的子元素。减少子元素的重新创建. <strong>再次强调:</strong> key 需要在父元素范围内不重复,并具有稳定性</p><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/react-docs/assets/app.a98f98c2.js" defer></script>
  </body>
</html>
